<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/output.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Poppins";
      }
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Firefox */
      input[type="number"] {
        -moz-appearance: textfield;
      }
    </style>
  </head>
  <body class="md:px-10 px-3 py-10 bg-gradient-to-l to-indigo-950 from-black">
    <div
      class="w-fit mx-auto mb-10 bg-blue-500/10 rounded-full px-3 py-0.5 border border-blue-400/20 text-md md:text-lg"
    >
    <button
      onclick="window.location.href = '/home'"
      class="text-slate-500 py-1 sm:px-5 px-2 rounded-full font-medium hover:text-slate-300 transition-all hover:scale-105"
    >
      Home
    </button>
    <button
      onclick="window.location.href = '/i-owe'"
      class="bg-clip-text bg-gradient-to-tr text-transparent from-purple-500 to-sky-500 font-medium py-1 sm:px-5 px-2 rounded-full transition-all hover:scale-105"
    >
      I Owe
    </button>
    <button
      onclick="window.location.href = '/they-owe'"
      class="text-slate-500 py-1 sm:px-5 px-2 rounded-full font-medium hover:text-slate-300 transition-all hover:scale-105"
    >
      They Owe
    </button>
    <button
      onclick="window.location.href = '/history'"
      class="text-slate-500 py-1 sm:px-5 px-2 rounded-full font-medium hover:text-slate-300 transition-all hover:scale-105"
    >
      History
    </button>
    <button
      onclick="window.location.href = '/split-the-bill'"
      class="text-slate-500 py-1 sm:px-5 px-2 rounded-full font-medium hover:text-slate-300 transition-all hover:scale-105"
    >
      Split the Bill
    </button>
    </div>

    <div class="group">
      <h1
        class="group-hover:scale-105 transition-all mx-auto font-extrabold text-7xl text-center bg-clip-text text-transparent bg-gradient-to-r from-purple-500 via-violet-600 to-blue-600 w-fit"
      >
        Owe No!
      </h1>
      <div
        class="group-hover:scale-105 delay-100 transition-all bg-gradient-to-r from-purple-500 via-violet-500 to-blue-500 w-fit mx-auto px-3 py-0.5 rounded-lg mt-2 shadow-lg shadow-violet-500/40"
      >
        <p class="text-white font-medium text-center">
          track debts, keep friends.
        </p>
      </div>
    </div>

    <div
      class="lg:w-1/2 w-4/5 2xl:w-1/3 3xl:w-1/3 mx-auto mt-10 transition-all"
    >
      <p class="font-semibold text-3xl ml-5 text-slate-300">
        I
        <span
          class="text-3xl font-bold text-transparent bg-gradient-to-tr to-sky-500 from-purple-500 bg-clip-text"
          >Owe</span
        >
      </p>
      <p class="font-normal text-sm lg:text-base ml-5 text-slate-400">
        Money you Borrowed
      </p>
    </div>

    <% if(debtData.paid) { %>

    <div class="lg:w-1/2 w-4/5 px-1 md:px-6 mx-auto 2xl:w-1/3 3xl:w-1/3 transition-all mt-5">
      <div class="border rounded-full border-green-500/40 bg-green-500/10 py-0.5">
        <p class="text-center text-green-600 font-medium">This Debt is Paid!</p>
      </div>
    </div>

    <% } %>

    <% const monthsShort = [ "Jan", "Febr", "Mar", "Apr", "May", "Jun", "Jul",
    "Aug", "Sep", "Oct", "Nov", "Dec", ]; %>

    <div
      class="lg:w-1/2 w-4/5 px-0 md:px-5 mx-auto 2xl:w-1/3 3xl:w-1/3 transition-all"
    >
      <div
        class="bg-purple-400/10 mt-2 mx-2 rounded-lg text-white px-4 py-2 border border-purple-500/20 hover:bg-purple-500/30 transition-all hover:shadow-md hover:shadow-purple-600/30 group"
      >
        <div class="flex items-center">
          <div class="flex-1">
            <p class="font-semibold md:text-lg text-base">
              <%= debtData.who %>
            </p>
            <p
              class="font-normal text-sm md:text-base text-purple-200/60 md:-mt-0.5 group-hover:text-purple-200/80"
            >
              <%= debtData.reason %>
            </p>
          </div>
          <div class="font-semibold text-xl md:text-2xl">
            <p class="text-purple-400/90 group-hover:text-purple-400">$
              <% if (debtData.paid){ %>
                <%= debtData.amount.toFixed(2) %>
              <% } else { %>
                <%= debtData.balance.toFixed(2) %>
              <% } %></p>
            <p
              class="font-medium text-sm text-purple-200/60 text-right group-hover:text-purple-200/80"
            >
            <%= monthsShort[debtData.due.getMonth()] +" "+ debtData.due.getDate()%>
            </p>
          </div>
        </div>
        <div class="flex gap-3 mt-2">
          <div class="flex gap-3 flex-1 text-purple-300/90">
            <p class="text-xs font-medium place-items-center flex">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 16 16"
                fill="currentColor"
                class="size-3 inline mr-1 text-purple-500"
              >
                <path
                  fill-rule="evenodd"
                  d="M4 1.75a.75.75 0 0 1 1.5 0V3h5V1.75a.75.75 0 0 1 1.5 0V3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2V1.75ZM4.5 6a1 1 0 0 0-1 1v4.5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-7Z"
                  clip-rule="evenodd"
                />
              </svg>
              <%= monthsShort[debtData.due.getMonth()] +" "+ debtData.due.getDate()%>
            </p>
            <p class="text-xs font-medium place-items-center flex">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 16 16"
                fill="currentColor"
                class="size-3 mr-1 text-purple-500"
              >
                <path
                  fill-rule="evenodd"
                  d="M1 8a7 7 0 1 1 14 0A7 7 0 0 1 1 8Zm7.75-4.25a.75.75 0 0 0-1.5 0V8c0 .414.336.75.75.75h3.25a.75.75 0 0 0 0-1.5h-2.5v-3.5Z"
                  clip-rule="evenodd"
                />
              </svg>

              <% 
                  var hour = debtData.createdAt.getHours(); 
                  var minute = debtData.createdAt.getMinutes();
                  var am_pm = '';

                  if (hour < 12) { 
                    if (hour === 0) { 
                      hour = 12;  // Midnight case
                    }
                    am_pm = 'AM'; 
                  } else { 
                    if (hour === 12) {
                      hour = 12;  // Noon case
                    } else {
                      hour -= 12; // Convert PM time
                    }
                    am_pm = 'PM'; 
                  }
                %>

                <%= hour+":"+minute+" "+am_pm%>
            </p>
          </div>
        </div>
      </div>
      <div>
        <form method="POST"
          class="m-2 border py-3 px-4 border-purple-500/50 w-fit rounded-lg ml-auto"
        >
          <label for="amount" class="text-purple-400 font-semibold"
            >Pay Debt</label
          ><br />
          <span
            class="text-purple-500 align-bottom font-semibold mt-2 text-lg mr-1"
            >$</span
          >
          <input required
          <%if(debtData.paid){%> disabled <%}%>
          max=<%=debtData.balance%>
            placeholder="-" 
            step="0.01"
            type="number"
            title="amount"
            name="amount"
            class="mr-1 mt-2 text-center w-20 text-lg rounded-md px-2 py-1 bg-purple-600/20 font-semibold text-white placeholder-purple-300/50 hover:bg-purple-600/30 active:bg-purple-600/50 transition-all active:ring-purple-600/50 focus:ring-1 focus:outline-none focus:ring-purple-600/50 focus:bg-purple-600/40"
          />
          <button type="submit" <%if(debtData.paid){%> disabled <%}%>
            class="bg-purple-600/80 w-fit py-1 px-5 rounded-md text-white font-semibold mx-auto text-lg shadow-md shadow-purple-600/30 hover:bg-purple-600 transition-all hover:scale-105 hover:shadow-600/40 active:bg-purple-600/90"
          >
            Pay
          </button>
        </form>
      </div>

      <p class="text-center text-white/80 font-semibold text-base mt-10">
        Payment History
      </p>

      <%if(debtHistory.length > 0){%>

      <% for (let i = 0; i < debtHistory.length; i++) {
            const element = debtHistory[i];%>
      <div
        class="m-2 border border-sky-500/50 text-sky-500 flex rounded-lg pl-4 pr-1 py-1 font-semibold"
      >
        <p class="">- $<%= element.amount_paid.toFixed(2)%></p>
        <div class="flex-1">
          <div class="mx-auto w-fit flex items-center justify-center h-full gap-0.5">
            <span
              class="mx-auto font-medium border rounded-l-full rounded-r-xl border-violet-500/80 pl-2 pr-1 text-xs bg-violet-500/10 text-violet-300/60"
              ><% const createdDate = element.createdAt.toString().split(" ") %>
              <%= createdDate[1]+" "+ createdDate[2]+ " "+ createdDate[3]%></span>
              <span
              class="mx-auto font-medium border rounded-r-full rounded-l-lg border-indigo-500/80 pr-2 pl-1 text-xs bg-indigo-500/10 text-indigo-300/60"
              >
              <% 
                  var hour = element.createdAt.getHours(); 
                  var minute = element.createdAt.getMinutes();
                  var am_pm = '';

                  if (hour < 12) { 
                    if (hour === 0) { 
                      hour = 12;  // Midnight case
                    }
                    am_pm = 'AM'; 
                  } else { 
                    if (hour === 12) {
                      hour = 12;  // Noon case
                    } else {
                      hour -= 12; // Convert PM time
                    }
                    am_pm = 'PM'; 
                  }
                %>

                <%= hour+":"+minute.toLocaleString('en-US', {minimumIntegerDigits: 2, useGrouping:false})+" "+am_pm%>
              </span>
          </div>
        </div>
        <div class="">
          <div class="bg-sky-600/80 px-3 rounded-sm text-white w-fit ml-auto">
            $<%= element.balance.toFixed(2)%>
          </div>
        </div>
      </div>

      <% }} %>
    </div>
  </body>
</html>
